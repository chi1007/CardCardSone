<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="{{ url_for('static', filename='image/icon/Croissant1.png') }}">
  <title>卡卡頌 CardCardSone</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/preference_question.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
 
 <script>

      let alertShown = false; // Global variable to track if alert has been shown

      function validateForm(event) {
        const totalQuestions = {{ questions|length }};
        let isAllAnswered = true;
        let firstUnansweredIndex = -1;
        let allUnanswered = false; // 標記是否所有題目都未作答

        // 檢查第一題是否作答
        const q0Answers = document.getElementsByName("q0");
        let q0Answered = false;
        for (let j = 0; j < q0Answers.length; j++) {
          if (q0Answers[j].checked) {
            q0Answered = true;
            break;
          }
        }

        if (!q0Answered) {
          isAllAnswered = false;
          firstUnansweredIndex = 0;
          allUnanswered = true; // 如果第一題未作答,則視為所有題目都未作答
        }

        // 檢查其他題目是否作答
        for (let i = 1; i < totalQuestions; i++) {
          const answers = document.getElementsByName("q" + i);
          let answered = false;
          for (let j = 0; j < answers.length; j++) {
            if (answers[j].checked) {
              answered = true;
              break;
            }
          }
          if (!answered) {
            isAllAnswered = false;
            if (firstUnansweredIndex === -1) {
              firstUnansweredIndex = i;
            }
          }
        }

        if (!isAllAnswered) {
          if (!alertShown) {
            alert("尚有題目未填答，請確認均填答完畢後再送出「提交」。");
            alertShown = true;
          }
          if (allUnanswered) {
            window.scrollTo({
              top: 0, // 滾動到頁面頂部
              behavior: 'smooth'
            });
          } else if (firstUnansweredIndex !== -1) {
            const firstUnansweredElement = document.getElementsByName("q" + firstUnansweredIndex)[0];
            const elementPosition = firstUnansweredElement.getBoundingClientRect().top + window.pageYOffset;
            const offsetPosition = elementPosition - 150; // 調整偏移量
            window.scrollTo({
              top: offsetPosition,
              behavior: 'smooth'
            });
          }
          return false; // 防止表單提交
        } else {
          alertShown = false; // 重設 alertShown 當所有題目都作答時
        }

        return true; // 允許表單提交,如果所有題目都作答
      }

          document.addEventListener('DOMContentLoaded', function () {
            const form = document.querySelector('form');
            form.addEventListener('submit', function (event) {
              if (!validateForm(event)) {
                event.preventDefault();
              } else {
                document.getElementById('loading').style.display = 'block';
              }
            });
          });
  </script>
</head>

<body>

  <button class="back-to-top" onclick="scrollToTop()"> <b>↑</b> </button>

  {% include 'header.html' %}

    </div>
    <div class="question">
    <h1 class="section-title text-center">智能推薦</h1>
    <h2>以下12道題目為您對卡片優惠項目的重視程度，完成填答後我們將為您分析推薦出最適合的三張卡片</h2>
    </div>
    <div class="form-container">
    <form action="/recommend" method="POST" onsubmit="return validateForm()">
        <!-- 第一題只有三個選項，使用單選框 -->
        <p>{{ questions[0].question }}</p>
        <span class="inline-flex items-center">
            <input type="radio" id="q0_1" name="q0" value="1" class="form-radio h-5 w-5 text-blue-600">
            <label for="q0_1" class="ml-2">信用卡</label>
        </span>
        <span class="inline-flex items-center">
            <input type="radio" id="q0_2" name="q0" value="2" class="form-radio h-5 w-5 text-blue-600">
            <label for="q0_2" class="ml-2">無特定偏好</label>
        </span>
        <span class="inline-flex items-center">
            <input type="radio" id="q0_3" name="q0" value="3" class="form-radio h-5 w-5 text-blue-600">
            <label for="q0_3" class="ml-2">金融卡</label>
        </span><br>
            <!-- 其他問題使用單選框 -->
        {% for question in questions[1:] %}
        <p>{{ question.question }}</p>
        <span class="inline-flex items-center">
             <input type="radio" id="q{{ loop.index }}_1" name="q{{ loop.index }}" value="1" class="form-radio h-5 w-5 text-blue-600">
             <label for="q{{ loop.index }}_1" class="ml-2">非常不重要</label>
        </span>
        <span class="inline-flex items-center">
             <input type="radio" id="q{{ loop.index }}_2" name="q{{ loop.index }}" value="2" class="form-radio h-5 w-5 text-blue-600">
             <label for="q{{ loop.index }}_2" class="ml-2">不重要</label>
        </span>
        <span class="inline-flex items-center">
             <input type="radio" id="q{{ loop.index }}_3" name="q{{ loop.index }}" value="3" class="form-radio h-5 w-5 text-blue-600">
             <label for="q{{ loop.index }}_3" class="ml-2">普通</label>
        </span>
        <span class="inline-flex items-center">
             <input type="radio" id="q{{ loop.index }}_4" name="q{{ loop.index }}" value="4" class="form-radio h-5 w-5 text-blue-600">
             <label for="q{{ loop.index }}_4" class="ml-2">重要</label>
        </span>
        <span class="inline-flex items-center">
             <input type="radio" id="q{{ loop.index }}_5" name="q{{ loop.index }}" value="5" class="form-radio h-5 w-5 text-blue-600">
             <label for="q{{ loop.index }}_5" class="ml-2">非常重要</label>
        </span><br>
        {% endfor %}
        <br>
        <input type="submit" value="提交">
    </form>
  </div>

  <div id="loading">
    <img src="{{ url_for('static', filename='image/icon/loading-dog.gif') }}" alt="Loading...">
    <p>分析生成中，請稍候</p>
  </div>

  {% include 'footer.html' %}
  
  <script src="{{ url_for('static', filename='js/common.js') }}"></script>
  </body>
  
  </html>